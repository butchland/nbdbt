# nbdbt
> Use jupyter notebooks for dbt development


[`dbt`](https://getdbt.com) (data build tool) is revolutionizing the way we do the process of extracting value from our data. 

This package allows Jupyter notebooks to be used for developing dbt models and analyses in complement with other dbt command line tools and VS Code extensions.

## Install

`pip install nbdbt`

## How to use

The `%%dbt` cell magic allows you to create models and analyses in your dbt project.

In addition, this package also leverages the `fal` package which provides useful modules for using dbt in python.

```python
# load dbt cell magic
%reload_ext nbdbt.dbt_cellmagic
```

This will create a new model `my_third_model` and compile it as well

```python
%%dbt -p ../my_dbt_project -a my_third_model -n notebooks/index.ipynb models/my_third_model.sql
select *
from {{ ref('my_second_dbt_model') }}
```

The cell above creates a file 'my_third_model.sql' in the 'models' directory of the dbt project directory '../my_dbt_project' and compiles it as well.

We then assigned the result of the compilation to the `my_third_model` variable, which is a Dbt (cell) magic object

```python
my_third_model
```




    <nbdbt.dbt_cellmagic.DbtMagicObject at 0x7f0f070191d0>



The `ref` method on `DbtMagicObject`  allows us to run the query and save the results into a dataframe.

```python
results = my_third_model.ref()
results  # dataframe
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>



The dbt magic object also has access to other useful properties (like the compiled sql used to create the results)

```python
print(my_third_model._compiled_sql)
```

    -- AUTOGENERATED! DO NOT EDIT! File to edit: notebooks/index.ipynb (unless otherwise specified).
    select *
    from `sample-dbt-learn-project`.`jaffle_shop`.`my_second_dbt_model`


We can then run the usual _dbt_ commands to generate the model 

```python
# no_test
%cd ../my_dbt_project
! dbt run --select my_third_model
%cd ../nbs
```

    /home/butch2/play/experiments/nbdbt/my_dbt_project
    06:48:18  Running with dbt=1.1.1
    06:48:18  Found 3 models, 4 tests, 0 snapshots, 3 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
    06:48:18  
    06:48:20  Concurrency: 1 threads (target='dev')
    06:48:20  
    06:48:20  1 of 1 START view model jaffle_shop.my_third_model ............................. [RUN]
    06:48:21  1 of 1 OK created view model jaffle_shop.my_third_model ........................ [[32mOK[0m in 1.31s]
    06:48:21  
    06:48:21  Finished running 1 view model in 3.01s.
    06:48:21  
    06:48:21  [32mCompleted successfully[0m
    06:48:21  
    06:48:21  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
    /home/butch2/play/experiments/nbdbt/nbs

