---

title: DBT Cell Magic 


keywords: fastai
sidebar: home_sidebar

summary: "provides the `%%dbt` cell magic for creating models and analyses "
description: "provides the `%%dbt` cell magic for creating models and analyses "
nb_path: "nbs/00_dbt_cellmagic.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_dbt_cellmagic.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="write_sql" class="doc_header"><code>write_sql</code><a href="https://github.com/butchland/nbdbt/tree/master/nbdbt/dbt_cellmagic.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>write_sql</code>(<strong><code>sql</code></strong>:<code>str</code>, <strong><code>file</code></strong>:<code>str</code>, <strong><code>project_dir</code></strong>:<code>str</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compile_model" class="doc_header"><code>compile_model</code><a href="https://github.com/butchland/nbdbt/tree/master/nbdbt/dbt_cellmagic.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compile_model</code>(<strong><code>project</code></strong>:<code>str</code>, <strong><code>model</code></strong>:<code>str</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="write_dbt" class="doc_header"><code>write_dbt</code><a href="https://github.com/butchland/nbdbt/tree/master/nbdbt/dbt_cellmagic.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>write_dbt</code>(<strong><code>line</code></strong>, <strong><code>cell</code></strong>)</p>
</blockquote>
<p>::</p>
<p>%write_dbt [-a ASSIGN] [-p PROJECT] [-n NOTEBOOK] file</p>
<p>positional arguments:
  file                  file path to write to</p>
<p>optional arguments:
  -a ASSIGN, --assign ASSIGN
                        If provided, save the output to this variable instead
                        of displaying it.
  -p PROJECT, --project PROJECT
                        dbt project directory
  -n NOTEBOOK, --notebook NOTEBOOK
                        notebook source file</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">dbt</span> -p ../my_dbt_project analyses/sample1.sql

select *
from {{ ref(&#39;my_first_dbt_model&#39;) }}
where id is not null
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>assign=None
project=../my_dbt_project
notebook=None
file=analyses/sample1.sql
06:22:36  Found 2 models, 4 tests, 0 snapshots, 3 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
06:22:36  
06:22:37  Concurrency: 1 threads (target=&#39;dev&#39;)
06:22:37  
06:22:38  Done.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RunExecutionResult(results=[RunResult(status=&lt;RunStatus.Success: &#39;success&#39;&gt;, timing=[TimingInfo(name=&#39;compile&#39;, started_at=datetime.datetime(2022, 6, 19, 6, 22, 37, 970523), completed_at=datetime.datetime(2022, 6, 19, 6, 22, 37, 976413)), TimingInfo(name=&#39;execute&#39;, started_at=datetime.datetime(2022, 6, 19, 6, 22, 37, 976990), completed_at=datetime.datetime(2022, 6, 19, 6, 22, 37, 977025))], thread_id=&#39;Thread-5&#39;, execution_time=0.007986068725585938, adapter_response={}, message=None, failures=None, node=CompiledAnalysisNode(raw_sql=&#34;-- AUTOGENERATED! DO NOT EDIT!\n\nselect *\nfrom {{ ref(&#39;my_first_dbt_model&#39;) }}\nwhere id is not null&#34;, compiled=True, database=&#39;sample-dbt-learn-project&#39;, schema=&#39;jaffle_shop&#39;, fqn=[&#39;my_dbt_project&#39;, &#39;analysis&#39;, &#39;sample1&#39;], unique_id=&#39;analysis.my_dbt_project.sample1&#39;, package_name=&#39;my_dbt_project&#39;, root_path=&#39;/home/butch2/play/experiments/nbdbt/my_dbt_project&#39;, path=&#39;analysis/sample1.sql&#39;, original_file_path=&#39;analyses/sample1.sql&#39;, name=&#39;sample1&#39;, resource_type=&lt;NodeType.Analysis: &#39;analysis&#39;&gt;, alias=&#39;sample1&#39;, checksum=FileHash(name=&#39;sha256&#39;, checksum=&#39;cc3fd4e7c3fd6ef264cbdcf237581b0d242f9ec1a4066d9ec337c2c657b693f1&#39;), config=NodeConfig(_extra={}, enabled=True, alias=None, schema=None, database=None, tags=[], meta={}, materialized=&#39;view&#39;, persist_docs={}, post_hook=[], pre_hook=[], quoting={}, column_types={}, full_refresh=None, unique_key=None, on_schema_change=&#39;ignore&#39;), _event_status={&#39;node_status&#39;: &lt;RunningStatus.Executing: &#39;executing&#39;&gt;}, tags=[], refs=[[&#39;my_first_dbt_model&#39;]], sources=[], depends_on=DependsOn(macros=[], nodes=[&#39;model.my_dbt_project.my_first_dbt_model&#39;]), description=&#39;&#39;, columns={}, meta={}, docs=Docs(show=True), patch_path=None, compiled_path=&#39;target/compiled/my_dbt_project/analyses/sample1.sql&#39;, build_path=None, deferred=False, unrendered_config={}, created_at=1655619756.7008507, config_call_dict={}, compiled_sql=&#39;-- AUTOGENERATED! DO NOT EDIT!\n\nselect *\nfrom `sample-dbt-learn-project`.`jaffle_shop`.`my_first_dbt_model`\nwhere id is not null&#39;, extra_ctes_injected=True, extra_ctes=[], relation_name=None, _pre_injected_sql=None), agate_table=None)], elapsed_time=1.3103978633880615, args={&#39;write_json&#39;: True, &#39;printer_width&#39;: 80, &#39;profiles_dir&#39;: &#39;/home/butch2/.dbt&#39;, &#39;event_buffer_size&#39;: 100000, &#39;project_dir&#39;: &#39;/home/butch2/play/experiments/nbdbt/my_dbt_project&#39;, &#39;parse_only&#39;: False, &#39;select&#39;: [&#39;analyses/sample1.sql&#39;], &#39;which&#39;: &#39;compile&#39;, &#39;rpc_method&#39;: &#39;compile&#39;, &#39;indirect_selection&#39;: &#39;eager&#39;}, generated_at=datetime.datetime(2022, 6, 19, 6, 22, 38, 68547))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="s2">&quot;sample2&quot;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="k">del</span> <span class="n">sample2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">dbt</span> -a sample2 -p ../my_dbt_project -n notebooks/00_dbt_cellmagic.ipynb analyses/sample2.sql 

select *
from {{ ref(&#39;my_second_dbt_model&#39;) }}
where id is not null
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>assign=sample2
project=../my_dbt_project
notebook=notebooks/00_dbt_cellmagic.ipynb
file=analyses/sample2.sql
06:22:38  Found 2 models, 4 tests, 0 snapshots, 3 analyses, 191 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics
06:22:38  
06:22:39  Concurrency: 1 threads (target=&#39;dev&#39;)
06:22:39  
06:22:39  Done.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>

<span class="n">notebook2script</span><span class="p">(</span><span class="s2">&quot;notebooks/00_dbt_cellmagic.ipynb&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>


